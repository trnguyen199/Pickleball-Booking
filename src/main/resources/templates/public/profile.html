<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
    <div th:replace="fragments/_layoutnavbar::layout-navbar"></div>
    <th:block th:fragment="layout-content">

        <div class="wrapper">
        
          <form action="/profile/update" method="post" th:object="${user}">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <input type="hidden" name="id" th:value="*{id}" /> <!-- Th√™m tr∆∞·ªùng ·∫©n cho ID -->
           
            <div class="wrapper-ct">
              <div class="profile-container">
                <div class="profile-card">
                  
                  <div><strong>T√™n ƒëƒÉng nh·∫≠p:</strong> <input type="text" name="username" th:value="*{username}" readonly /></div>
                  <div><strong>Email:</strong> <input type="email" name="email" th:value="*{email}" required /></div>
                  <div><strong>H·ªç v√† t√™n:</strong> <input type="text" name="fullName" th:value="*{fullName}" required /></div>
                  <div><strong>Gi·ªõi t√≠nh:</strong>
                      <select name="gender" th:value="*{gender}">
                          <option value="Nam" th:selected="*{gender == 'Nam'}">Nam</option>
                          <option value="N·ªØ" th:selected="*{gender == 'N·ªØ'}">N·ªØ</option>
                          <option value="Kh√°c" th:selected="*{gender == 'Kh√°c'}">Kh√°c</option>
                      </select>
                  </div>
                  <div><strong>Ng√†y sinh:</strong> <input type="date" name="dob" th:value="*{dob}" required /></div>
                  <div><strong>SƒêT:</strong> <input type="text" name="phone" th:value="*{phone}" required /></div>
                  <div><strong>ƒê·ªãa ch·ªâ:</strong> <input type="text" name="address" th:value="*{address}" /></div>
        
                  <button type="submit" onclick="showToast()">üíæ L∆∞u thay ƒë·ªïi</button>
                  <a th:href="@{/logout}" class="btn-logout">ƒêƒÉng xu·∫•t</a>

                </div>
              </div>
              <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
              <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
      
              <!-- L·ªãch s·ª≠ ƒë·∫∑t s√¢n -->
            <div class="history-container">
                <h2>L·ªãch s·ª≠ ƒë·∫∑t s√¢n</h2>
                <table class="history-table">
                    <thead>
                    <tr>
                        <th>T√™n s√¢n</th>
                        <th>ƒê·ªãa ch·ªâ</th>
                        <th>Khung gi·ªù ƒë√£ ƒë·∫∑t</th>
                        <th>S·ªë ti·ªÅn</th>
                        <th>ƒê√°nh gi√°</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="booking : ${bookings}">
                        <td th:text="${booking.court.name}">T√™n s√¢n</td>
                        <td th:text="${booking.court.location}">ƒê·ªãa ch·ªâ</td>
                        <td th:text="${booking.timeSlot.startTime + ' - ' + booking.timeSlot.endTime}">Khung gi·ªù</td>
                        <td th:text="${booking.price} + '‚Ç´'">S·ªë ti·ªÅn</td>
                        <td>
                    <span th:if="${booking.review != null}">
                      <span th:text="${booking.review}"></span>
                      <span th:if="${booking.rating != null}">
                        (<span th:text="${booking.rating}"></span>‚≠ê)
                      </span>
                      <button class="review-btn" disabled style="opacity:0.5;cursor:not-allowed;">ƒê√£ ƒë√°nh gi√°</button>
                    </span>
                            <button th:if="${booking.review == null}" class="review-btn" type="button"
                                    th:attr="onclick=|showReviewForm('${booking.id}')|">ƒê√°nh gi√°</button>
                        </td>
                    </tr>
                    <!-- D√≤ng kh√°c s·∫Ω l·∫∑p ·ªü ƒë√¢y -->
                    </tbody>
                </table>
            </div>
          </form>
            <!-- Form ƒë√°nh gi√° ·∫©n (ƒë·∫∑t ngo√†i form c·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n) -->
        <div id="reviewModal" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 8px #0003;">
            <form method="post" th:action="@{/profile/review}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="bookingId" id="reviewBookingId">
                <label>Ch·ªçn s·ªë sao:</label>
                <div id="star-rating">
                    <input type="radio" name="rating" value="1" required> 1‚≠ê
                    <input type="radio" name="rating" value="2"> 2‚≠ê
                    <input type="radio" name="rating" value="3"> 3‚≠ê
                    <input type="radio" name="rating" value="4"> 4‚≠ê
                    <input type="radio" name="rating" value="5"> 5‚≠ê
                </div>
                <label for="reviewContent">Nh·∫≠p ƒë√°nh gi√°:</label>
                <textarea name="review" id="reviewContent" required></textarea>
                <br>
                <button type="submit">G·ª≠i</button>
                <button type="button" onclick="closeReviewForm()">H·ªßy</button>
            </form>
        </div>
        </div>
    </th:block>
    <div th:replace="fragments/_layoutfooter::layout-footer"></div>

</body>
<style>
    /* Ti√™u ƒë·ªÅ b·∫£ng */
    .history-table th {
        color: #000000; /* M√†u ƒëen */
        font-weight: bold; /* ƒê·∫≠m ch·ªØ */
        text-align: center; /* CƒÉn gi·ªØa n·ªôi dung */
    }
    /* L·ªãch s·ª≠ ƒë·∫∑t s√¢n container */
    .history-container {
        margin-top: 20px;
        padding: 20px;
        background-color: #f8f9fa; /* M√†u n·ªÅn nh·∫°t */
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Hi·ªáu ·ª©ng ƒë·ªï b√≥ng */
    }

    /* Ti√™u ƒë·ªÅ */
    .history-container h2 {
        text-align: center;
        font-size: 1.8rem;
        color: #343a40; /* M√†u ch·ªØ ƒë·∫≠m */
        margin-bottom: 20px;
    }

    /* B·∫£ng */
    .history-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1rem;
        text-align: left;
    }

    .history-table thead {
        background-color: #343a40; /* M√†u n·ªÅn ti√™u ƒë·ªÅ b·∫£ng */
        color: #ffffff; /* M√†u ch·ªØ ti√™u ƒë·ªÅ b·∫£ng */
    }

    .history-table th,
    .history-table td {
        padding: 12px 15px;
        border: 1px solid #dee2e6; /* ƒê∆∞·ªùng vi·ªÅn b·∫£ng */
    }

    .history-table tbody tr:nth-child(even) {
        background-color: #f1f3f5; /* M√†u n·ªÅn cho h√†ng ch·∫µn */
    }

    .history-table tbody tr:hover {
        background-color: #e9ecef; /* Hi·ªáu ·ª©ng hover */
        transition: background-color 0.3s ease;
    }

    /* N√∫t ƒë√°nh gi√° */
    .review-btn {
        background-color: #007bff; /* M√†u xanh d∆∞∆°ng */
        color: #ffffff; /* M√†u ch·ªØ tr·∫Øng */
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .review-btn:hover {
        background-color: #0056b3; /* M√†u xanh ƒë·∫≠m h∆°n khi hover */
        transition: background-color 0.3s ease;
    }
    .btn-logout {
        background-color: #ff4d4f; /* m√†u ƒë·ªè nh·∫π */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s ease;
      }
      
      .btn-logout:hover {
        background-color: #d9363e; /* ƒë·∫≠m h∆°n khi hover */
        color: #000;
      }
</style>
<script>
    function showReviewForm(bookingId) {
        document.getElementById('reviewBookingId').value = bookingId;
        document.getElementById('reviewModal').style.display = 'block';
    }
    function closeReviewForm() {
        document.getElementById('reviewModal').style.display = 'none';
    }
</script>
</html>
