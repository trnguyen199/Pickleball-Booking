<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
    <div th:replace="fragments/_layoutnavbar::layout-navbar"></div>
    <main class="container-pa">
        <div th:replace="fragments/_layoutsidebar::sidebar"></div>
        <div class="content-pa">
            <h1>Quản lý khung giờ sân</h1>
            <div class="time-settings">
                <label for="open-time">Giờ mở cửa:</label>
                <input type="time" id="open-time" value="06:00">

                <label for="close-time">Giờ đóng cửa:</label>
                <input type="time" id="close-time" value="22:00">

                <label for="duration">Thời lượng mỗi khung giờ (phút):</label>
                <select id="duration">
                    <option value="30">30 phút</option>
                    <option value="60" selected>60 phút</option>
                    <option value="90">90 phút</option>
                    <option value="120">120 phút</option>
                </select>

                <button class="generate-btn" onclick="generateSlots()">Tạo khung giờ</button>

                <div class="slot-list" id="slot-list">
                    <!-- Danh sách khung giờ sẽ hiện ở đây -->
                </div>
            </div>
        </div>
    </main>
    <div th:replace="fragments/_layoutfooter::layout-footer"></div>
</body>
<script>
    function generateSlots() {
        const openTime = document.getElementById("open-time").value;
        const closeTime = document.getElementById("close-time").value;
        const duration = parseInt(document.getElementById("duration").value);
        const list = document.getElementById("slot-list");
    
        list.innerHTML = "";
    
        let [oh, om] = openTime.split(":").map(Number);
        let [ch, cm] = closeTime.split(":").map(Number);
    
        let start = new Date();
        start.setHours(oh, om, 0, 0);
    
        let end = new Date();
        end.setHours(ch, cm, 0, 0);
    
        const timeSlots = [];
    
        while (start < end) {
            let slotStart = new Date(start);
            start.setMinutes(start.getMinutes() + duration);
            if (start > end) break;
            let slotEnd = new Date(start);
    
            const format = (d) => d.toTimeString().slice(0, 5);
            const div = document.createElement("div");
            div.className = "slot-item";
            div.innerHTML = `
                ${format(slotStart)} - ${format(slotEnd)}
                <button onclick="this.parentElement.remove()">Xoá</button>
            `;
            list.appendChild(div);
    
            // Tạo các đối tượng TimeSlot
            timeSlots.push({
                startTime: format(slotStart),
                endTime: format(slotEnd)
            });
        }
    
        // Gửi danh sách các khung giờ tới backend
        fetch("/api/timeslots/save", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(timeSlots)
        })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error("Lỗi khi lưu khung giờ", error));
    }
    
</script>
</html>